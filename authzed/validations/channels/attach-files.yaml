schemaFile: "../../beep.zed"
relationships: |-
  // Server setup
  server:test_server#owner@user:owner

  // Roles setup
  role:uploader#server@server:test_server
  role:uploader#member@user:uploader_user
  
  role:basic#server@server:test_server
  role:basic#member@user:basic_user1
  role:basic#member@user:basic_user2
  role:basic#member@user:basic_user3

  // Channel setup
  channel:test_channel#server@server:test_server

  // Base permissions - only uploaders can attach files by default
  server:test_server#file_attacher@role:uploader#member
  
  // Override scenarios
  // Grant specific basic user permission (user-level grant)
  channel:test_channel#attach_files_grant@user:basic_user1
  
  // Deny uploader user permission (user-level deny overrides role permission)
  channel:test_channel#attach_files_deny@user:uploader_user
  
  // Grant then deny same user (deny should win)
  channel:test_channel#attach_files_grant@user:basic_user2
  channel:test_channel#attach_files_deny@user:basic_user2

assertions:
  assertTrue:
    - channel:test_channel#attach_files@user:owner        # Server owner can attach files
    - channel:test_channel#attach_files@user:basic_user1  # Basic user granted via user override

  assertFalse:
    - channel:test_channel#attach_files@user:uploader_user # Uploader denied via user override
    - channel:test_channel#attach_files@user:basic_user2   # User with both grant and deny (deny wins)
    - channel:test_channel#attach_files@user:basic_user3   # Basic user with no overrides
