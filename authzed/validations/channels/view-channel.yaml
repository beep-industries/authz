schemaFile: "../../beep.zed"
relationships: |-
  // Server setup
  server:test_server#owner@user:owner

  // Roles setup
  role:viewer#server@server:test_server
  role:viewer#member@user:viewer_user
  
  role:basic#server@server:test_server
  role:basic#member@user:basic_user1
  role:basic#member@user:basic_user2
  role:basic#member@user:basic_user3

  // Channel setup
  channel:test_channel#server@server:test_server

  // Base permissions - only viewers can view by default
  server:test_server#channel_viewer@role:viewer#member
  
  // Override scenarios
  // Grant specific basic user permission (user-level grant)
  channel:test_channel#view_channel_grant@user:basic_user1
  
  // Deny viewer user permission (user-level deny overrides role permission)
  channel:test_channel#view_channel_deny@user:viewer_user
  
  // Grant then deny same user (deny should win)
  channel:test_channel#view_channel_grant@user:basic_user2
  channel:test_channel#view_channel_deny@user:basic_user2

assertions:
  assertTrue:
    - channel:test_channel#view@user:owner        # Server owner can view channel
    - channel:test_channel#view@user:basic_user1  # Basic user granted via user override

  assertFalse:
    - channel:test_channel#view@user:viewer_user  # Viewer denied via user override
    - channel:test_channel#view@user:basic_user2  # User with both grant and deny (deny wins)
    - channel:test_channel#view@user:basic_user3  # Basic user with no overrides
